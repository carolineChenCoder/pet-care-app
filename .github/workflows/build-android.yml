name: Build Pet Care Assistant APK

on:
  push:
    branches: [ main, master ]
    tags:
      - 'v*'
  workflow_dispatch:

jobs:
  build:
    name: Build Android APK
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ— Checkout repository
      uses: actions/checkout@v4

    - name: ğŸ— Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'

    - name: ğŸ“¦ Install dependencies
      run: npm ci

    - name: ğŸ— Setup EAS
      uses: expo/expo-github-action@v8
      with:
        eas-version: latest
        token: ${{ secrets.EXPO_TOKEN }}

    - name: ğŸš€ Build APK
      run: |
        eas build --platform android --profile preview --non-interactive --clear-cache
      env:
        EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}

    - name: ğŸ“± Create Release
      if: startsWith(github.ref, 'refs/tags/')
      uses: softprops/action-gh-release@v1
      with:
        files: |
          *.apk
        body: |
          # ğŸ¾ Pet Care Assistant v${{ github.ref_name }}
          
          ## ğŸ“± Download for Android
          
          **Download the APK below and install on your Android device**
          
          ## ğŸŒ International Features
          - âœ… **Works Offline** - No internet required after installation
          - âœ… **Multi-language** - English, Spanish, Chinese support
          - âœ… **Global Emergency Contacts** - Country-specific vet numbers
          - âœ… **Breed-specific Advice** - For dogs worldwide
          - âœ… **Privacy Focused** - All data stays on your device
          
          ## ğŸ“² Installation Instructions
          
          ### For Android:
          1. **Download APK** file below
          2. **Enable Unknown Sources**: Settings > Security > Install unknown apps
          3. **Install APK** by tapping the downloaded file  
          4. **Open App** and add your pet information
          
          ## ğŸ©º Features
          - Smart symptom checker with severity assessment
          - Comprehensive health reports by breed
          - Emergency first aid procedures
          - Pet poison helpline numbers
          - Offline functionality
          
          ## ğŸ†˜ Support
          
          - **Issues**: [Report bugs](https://github.com/${{ github.repository }}/issues)
          - **Questions**: Create a discussion
          
          ## âš ï¸ Important
          
          This app provides general guidance only. Always consult a veterinarian for serious health concerns.
          
          ---
          
          **Share with friends worldwide** ğŸŒ - Send them this GitHub link!
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}